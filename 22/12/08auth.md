# Azure AD の全体管理者の二段階認証の回避は絶対やってはいけない

全体管理者は、二段階認証を必ず設定すべきです。  
試用版であったとしても、非常に危ないということを認識してください。

## 本当にあった怖い話

試用版でしばらく検証などに使っていた環境を、そのまま開発環境に昇格することはよくあると思いますが、  
以下のような簡単なテナント名で設定していて

```
test20221208.onmicrosoft.com
```

簡単なユーザー名

```
admin@test20221208.onmicrosoft.com
```

簡単なパスワード

```
p@ssw0rd
```

とかに設定してしいたところ・・  
それぞれを推測されてしまい、不正にログインされました。
しかも、Azure 上にものすごく高価な仮想マシンを作られてしまい、おそらく仮想通貨のマイニングに使われていました。

せめて週１回は課金情報を確認しておくべきだったのですが、１ヶ月くらい不正利用されたあと、高額な請求に気づきました。  
Microsoft に問い合わせしても、結局引き落としが行われることになります。  
しかも、客先のクレジットカードでした。  
実話です。以下実際のメールのやりとりの抜粋。

```
本件に関する内容について、現在引き続き複数の関連部門にて調査を進めている状況でございます。
しかしながら、現時点で明確な内容の確認までには至っておりません。

また、2021 年 7 月 6 日 に今回のご請求金額の [1,747,657 円] のお支払いが、完了していることをシステム上確認いたしました。
上記内容を含めて、可能な限り迅速に対応をおこなってまいります。

お忙しいところ恐縮ですが、調査完了まで今しばらくお待ちいただけますようお願い申し上げます。
```

みなさまのご好意があってなんとか収まった？のですが、二段階認証の回避は一生しないこと、２段階認証の必要性を啓蒙し続けることを誓いました。

# 二段階認証の回避をすると

二段階認証の回避をするとこのメッセージが出なくなります。  
出ないほうが便利なのでどうしてもやりたくなりますよね。

<img src="22/12/08-1.png" height="600" style="object-fit:contain" />

# 二段階認証を回避する方法

絶対やってはいけないのですが、やる方法は以下です。
<br /><br />

- Azure Portal にログインして Azure Active Directory 　を選択

<img src="22/12/08-3.png" height="300" style="object-fit:contain" />

<br /><br />

- プロパティ　＞　セキュリティ既定値の管理 を選択

<img src="22/12/08-4.png" height="600" style="object-fit:contain" />

<br /><br />

- セキュリティ既定値の有効化 を　「いいえ」　に変更

<img src="22/12/08-5.png" height="600" style="object-fit:contain" />

<br /><br />

# 本来どうすべきか

以下、対応指針案です。

- 試用版であったとしても、必ず、全体管理者は２段階認証を有効にする。
- 全体管理者を複数作るのことは問題ないので、管理者それぞれに ID を配布し、全体管理者の ID は共有しない。
- 全体管理者のユーザー名は admin など簡単な文字列にしない。
- Azure の課金情報は 1 週間に 1 回以上確認する。
- 仕様版の製品を利用するときでも、全体管理者ではないユーザーを作り、 そちらに Office365 や Dynamics365 のライセンスをつけて利用する。
  （全体管理者ではないユーザーに、Dynamics 365 のシステム管理者ロールをつけることは問題ない。）

## Microsoft 製品エンジニア各位

経験年数に関係なくすべての Microsoft 製品エンジニアは、自社は言うに及ばず、お客様やその他関係者の Azure 環境がセキュリティが低い状態であることを認識したら、それを改善に導くことは最低限の責務と考えて行動してください。 ([おまいう](https://biz.trans-suite.jp/89855))
